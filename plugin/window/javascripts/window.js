var Window=Class.create();Window.keepMultiModalWindow=false;Window.hasEffectLib=typeof Effect!="undefined";Window.resizeEffectDuration=.4;Window.prototype={initialize:function(){var e;var t=0;if(arguments.length>0){if(typeof arguments[0]=="string"){e=arguments[0];t=1}else e=arguments[0]?arguments[0].id:null}if(!e)e="window_"+(new Date).getTime();if($(e))alert("Window "+e+" is already registered in the DOM! Make sure you use setDestroyOnClose() or destroyOnClose: true in the constructor");this.options=Object.extend({className:"dialog",blurClassName:null,minWidth:100,minHeight:20,resizable:true,closable:true,minimizable:true,maximizable:true,draggable:true,userData:null,showEffect:Window.hasEffectLib?Effect.Appear:Element.show,hideEffect:Window.hasEffectLib?Effect.Fade:Element.hide,showEffectOptions:{},hideEffectOptions:{},effectOptions:null,parent:document.body,title:"&nbsp;",url:null,onload:Prototype.emptyFunction,width:200,height:300,opacity:1,recenterAuto:true,wiredDrag:false,closeCallback:null,destroyOnClose:false,gridX:1,gridY:1},arguments[t]||{});if(this.options.blurClassName)this.options.focusClassName=this.options.className;if(typeof this.options.top=="undefined"&&typeof this.options.bottom=="undefined")this.options.top=this._round(Math.random()*500,this.options.gridY);if(typeof this.options.left=="undefined"&&typeof this.options.right=="undefined")this.options.left=this._round(Math.random()*500,this.options.gridX);if(this.options.effectOptions){Object.extend(this.options.hideEffectOptions,this.options.effectOptions);Object.extend(this.options.showEffectOptions,this.options.effectOptions);if(this.options.showEffect==Element.Appear)this.options.showEffectOptions.to=this.options.opacity}if(Window.hasEffectLib){if(this.options.showEffect==Effect.Appear)this.options.showEffectOptions.to=this.options.opacity;if(this.options.hideEffect==Effect.Fade)this.options.hideEffectOptions.from=this.options.opacity}if(this.options.hideEffect==Element.hide)this.options.hideEffect=function(){Element.hide(this.element);if(this.options.destroyOnClose)this.destroy()}.bind(this);if(this.options.parent!=document.body)this.options.parent=$(this.options.parent);this.element=this._createWindow(e);this.element.win=this;this.eventMouseDown=this._initDrag.bindAsEventListener(this);this.eventMouseUp=this._endDrag.bindAsEventListener(this);this.eventMouseMove=this._updateDrag.bindAsEventListener(this);this.eventOnLoad=this._getWindowBorderSize.bindAsEventListener(this);this.eventMouseDownContent=this.toFront.bindAsEventListener(this);this.eventResize=this._recenter.bindAsEventListener(this);this.topbar=$(this.element.id+"_top");this.bottombar=$(this.element.id+"_bottom");this.content=$(this.element.id+"_content");Event.observe(this.topbar,"mousedown",this.eventMouseDown);Event.observe(this.bottombar,"mousedown",this.eventMouseDown);Event.observe(this.content,"mousedown",this.eventMouseDownContent);Event.observe(window,"load",this.eventOnLoad);Event.observe(window,"resize",this.eventResize);Event.observe(window,"scroll",this.eventResize);Event.observe(this.options.parent,"scroll",this.eventResize);if(this.options.draggable){var n=this;[this.topbar,this.topbar.up().previous(),this.topbar.up().next()].each(function(e){e.observe("mousedown",n.eventMouseDown);e.addClassName("top_draggable")});[this.bottombar.up(),this.bottombar.up().previous(),this.bottombar.up().next()].each(function(e){e.observe("mousedown",n.eventMouseDown);e.addClassName("bottom_draggable")})}if(this.options.resizable){this.sizer=$(this.element.id+"_sizer");Event.observe(this.sizer,"mousedown",this.eventMouseDown)}this.useLeft=null;this.useTop=null;if(typeof this.options.left!="undefined"){this.element.setStyle({left:parseFloat(this.options.left)+"px"});this.useLeft=true}else{this.element.setStyle({right:parseFloat(this.options.right)+"px"});this.useLeft=false}if(typeof this.options.top!="undefined"){this.element.setStyle({top:parseFloat(this.options.top)+"px"});this.useTop=true}else{this.element.setStyle({bottom:parseFloat(this.options.bottom)+"px"});this.useTop=false}this.storedLocation=null;this.setOpacity(this.options.opacity);if(this.options.zIndex)this.setZIndex(this.options.zIndex);if(this.options.destroyOnClose)this.setDestroyOnClose(true);this._getWindowBorderSize();this.width=this.options.width;this.height=this.options.height;this.visible=false;this.constraint=false;this.constraintPad={top:0,left:0,bottom:0,right:0};if(this.width&&this.height)this.setSize(this.options.width,this.options.height);this.setTitle(this.options.title);Windows.register(this)},destroy:function(){this._notify("onDestroy");Event.stopObserving(this.topbar,"mousedown",this.eventMouseDown);Event.stopObserving(this.bottombar,"mousedown",this.eventMouseDown);Event.stopObserving(this.content,"mousedown",this.eventMouseDownContent);Event.stopObserving(window,"load",this.eventOnLoad);Event.stopObserving(window,"resize",this.eventResize);Event.stopObserving(window,"scroll",this.eventResize);Event.stopObserving(this.content,"load",this.options.onload);if(this._oldParent){var e=this.getContent();var t=null;for(var n=0;n<e.childNodes.length;n++){t=e.childNodes[n];if(t.nodeType==1)break;t=null}if(t)this._oldParent.appendChild(t);this._oldParent=null}if(this.sizer)Event.stopObserving(this.sizer,"mousedown",this.eventMouseDown);if(this.options.url)this.content.src=null;if(this.iefix)Element.remove(this.iefix);Element.remove(this.element);Windows.unregister(this)},setCloseCallback:function(e){this.options.closeCallback=e},getContent:function(){return this.content},setContent:function(e,t,n){var r=$(e);if(null==r)throw"Unable to find element '"+e+"' in DOM";this._oldParent=r.parentNode;var i=null;var s=null;if(t)i=Element.getDimensions(r);if(n)s=Position.cumulativeOffset(r);var o=this.getContent();this.setHTMLContent("");o=this.getContent();o.appendChild(r);r.show();if(t)this.setSize(i.width,i.height);if(n)this.setLocation(s[1]-this.heightN,s[0]-this.widthW)},setHTMLContent:function(e){if(this.options.url){this.content.src=null;this.options.url=null;var t='<div id="'+this.getId()+'_content" class="'+this.options.className+'_content"> </div>';$(this.getId()+"_table_content").innerHTML=t;this.content=$(this.element.id+"_content")}this.getContent().innerHTML=e},setAjaxContent:function(e,t,n,r){this.showFunction=n?"showCenter":"show";this.showModal=r||false;t=t||{};this.setHTMLContent("");this.onComplete=t.onComplete;if(!this._onCompleteHandler)this._onCompleteHandler=this._setAjaxContent.bind(this);t.onComplete=this._onCompleteHandler;new Ajax.Request(e,t);t.onComplete=this.onComplete},_setAjaxContent:function(e){Element.update(this.getContent(),e.responseText);if(this.onComplete)this.onComplete(e);this.onComplete=null;this[this.showFunction](this.showModal)},setURL:function(e){if(this.options.url)this.content.src=null;this.options.url=e;var t="<iframe frameborder='0' name='"+this.getId()+"_content'  id='"+this.getId()+"_content' src='"+e+"' width='"+this.width+"' height='"+this.height+"'> </iframe>";$(this.getId()+"_table_content").innerHTML=t;this.content=$(this.element.id+"_content")},getURL:function(){return this.options.url?this.options.url:null},refresh:function(){if(this.options.url)$(this.element.getAttribute("id")+"_content").src=this.options.url},setCookie:function(e,t,n,r,i){e=e||this.element.id;this.cookie=[e,t,n,r,i];var s=WindowUtilities.getCookie(e);if(s){var o=s.split(",");var u=o[0].split(":");var a=o[1].split(":");var f=parseFloat(o[2]),l=parseFloat(o[3]);var c=o[4];var h=o[5];this.setSize(f,l);if(c=="true")this.doMinimize=true;else if(h=="true")this.doMaximize=true;this.useLeft=u[0]=="l";this.useTop=a[0]=="t";this.element.setStyle(this.useLeft?{left:u[1]}:{right:u[1]});this.element.setStyle(this.useTop?{top:a[1]}:{bottom:a[1]})}},getId:function(){return this.element.id},setDestroyOnClose:function(){this.options.destroyOnClose=true},setConstraint:function(e,t){this.constraint=e;this.constraintPad=Object.extend(this.constraintPad,t||{});if(this.useTop&&this.useLeft)this.setLocation(parseFloat(this.element.style.top),parseFloat(this.element.style.left))},_initDrag:function(e){if(Event.element(e)==this.sizer&&this.isMinimized())return;if(Event.element(e)!=this.sizer&&this.isMaximized())return;if(Prototype.Browser.IE&&this.heightN==0)this._getWindowBorderSize();this.pointer=[this._round(Event.pointerX(e),this.options.gridX),this._round(Event.pointerY(e),this.options.gridY)];if(this.options.wiredDrag)this.currentDrag=this._createWiredElement();else this.currentDrag=this.element;if(Event.element(e)==this.sizer){this.doResize=true;this.widthOrg=this.width;this.heightOrg=this.height;this.bottomOrg=parseFloat(this.element.getStyle("bottom"));this.rightOrg=parseFloat(this.element.getStyle("right"));this._notify("onStartResize")}else{this.doResize=false;var t=$(this.getId()+"_close");if(t&&Position.within(t,this.pointer[0],this.pointer[1])){this.currentDrag=null;return}this.toFront();if(!this.options.draggable)return;this._notify("onStartMove")}Event.observe(document,"mouseup",this.eventMouseUp,false);Event.observe(document,"mousemove",this.eventMouseMove,false);WindowUtilities.disableScreen("__invisible__","__invisible__",this.overlayOpacity);document.body.ondrag=function(){return false};document.body.onselectstart=function(){return false};this.currentDrag.show();Event.stop(e)},_round:function(e,t){return t==1?e:e=Math.floor(e/t)*t},_updateDrag:function(e){var t=[this._round(Event.pointerX(e),this.options.gridX),this._round(Event.pointerY(e),this.options.gridY)];var n=t[0]-this.pointer[0];var r=t[1]-this.pointer[1];if(this.doResize){var i=this.widthOrg+n;var s=this.heightOrg+r;n=this.width-this.widthOrg;r=this.height-this.heightOrg;if(this.useLeft)i=this._updateWidthConstraint(i);else this.currentDrag.setStyle({right:this.rightOrg-n+"px"});if(this.useTop)s=this._updateHeightConstraint(s);else this.currentDrag.setStyle({bottom:this.bottomOrg-r+"px"});this.setSize(i,s);this._notify("onResize")}else{this.pointer=t;if(this.useLeft){var o=parseFloat(this.currentDrag.getStyle("left"))+n;var u=this._updateLeftConstraint(o);this.pointer[0]+=u-o;this.currentDrag.setStyle({left:u+"px"})}else this.currentDrag.setStyle({right:parseFloat(this.currentDrag.getStyle("right"))-n+"px"});if(this.useTop){var a=parseFloat(this.currentDrag.getStyle("top"))+r;var f=this._updateTopConstraint(a);this.pointer[1]+=f-a;this.currentDrag.setStyle({top:f+"px"})}else this.currentDrag.setStyle({bottom:parseFloat(this.currentDrag.getStyle("bottom"))-r+"px"});this._notify("onMove")}if(this.iefix)this._fixIEOverlapping();this._removeStoreLocation();Event.stop(e)},_endDrag:function(e){WindowUtilities.enableScreen("__invisible__");if(this.doResize)this._notify("onEndResize");else this._notify("onEndMove");Event.stopObserving(document,"mouseup",this.eventMouseUp,false);Event.stopObserving(document,"mousemove",this.eventMouseMove,false);Event.stop(e);this._hideWiredElement();this._saveCookie();document.body.ondrag=null;document.body.onselectstart=null},_updateLeftConstraint:function(e){if(this.constraint&&this.useLeft&&this.useTop){var t=this.options.parent==document.body?WindowUtilities.getPageSize().windowWidth:this.options.parent.getDimensions().width;if(e<this.constraintPad.left)e=this.constraintPad.left;if(e+this.width+this.widthE+this.widthW>t-this.constraintPad.right)e=t-this.constraintPad.right-this.width-this.widthE-this.widthW}return e},_updateTopConstraint:function(e){if(this.constraint&&this.useLeft&&this.useTop){var t=this.options.parent==document.body?WindowUtilities.getPageSize().windowHeight:this.options.parent.getDimensions().height;var n=this.height+this.heightN+this.heightS;if(e<this.constraintPad.top)e=this.constraintPad.top;if(e+n>t-this.constraintPad.bottom)e=t-this.constraintPad.bottom-n}return e},_updateWidthConstraint:function(e){if(this.constraint&&this.useLeft&&this.useTop){var t=this.options.parent==document.body?WindowUtilities.getPageSize().windowWidth:this.options.parent.getDimensions().width;var n=parseFloat(this.element.getStyle("left"));if(n+e+this.widthE+this.widthW>t-this.constraintPad.right)e=t-this.constraintPad.right-n-this.widthE-this.widthW}return e},_updateHeightConstraint:function(e){if(this.constraint&&this.useLeft&&this.useTop){var t=this.options.parent==document.body?WindowUtilities.getPageSize().windowHeight:this.options.parent.getDimensions().height;var n=parseFloat(this.element.getStyle("top"));if(n+e+this.heightN+this.heightS>t-this.constraintPad.bottom)e=t-this.constraintPad.bottom-n-this.heightN-this.heightS}return e},_createWindow:function(e){var t=this.options.className;var n=document.createElement("div");n.setAttribute("id",e);n.className="dialog";var r;if(this.options.url)r='<iframe frameborder="0" name="'+e+'_content"  id="'+e+'_content" src="'+this.options.url+'"> </iframe>';else r='<div id="'+e+'_content" class="'+t+'_content"> </div>';var i=this.options.closable?"<div class='"+t+"_close' id='"+e+"_close' onclick='Windows.close(\""+e+"\", event)'> </div>":"";var s=this.options.minimizable?"<div class='"+t+"_minimize' id='"+e+"_minimize' onclick='Windows.minimize(\""+e+"\", event)'> </div>":"";var o=this.options.maximizable?"<div class='"+t+"_maximize' id='"+e+"_maximize' onclick='Windows.maximize(\""+e+"\", event)'> </div>":"";var u=this.options.resizable?"class='"+t+"_sizer' id='"+e+"_sizer'":"class='"+t+"_se'";var a="../themes/default/blank.gif";n.innerHTML=i+s+o+"      <table id='"+e+"_row1' class=\"top table_window\">        <tr>          <td class='"+t+"_nw'></td>          <td class='"+t+"_n'><div id='"+e+"_top' class='"+t+"_title title_window'>"+this.options.title+"</div></td>          <td class='"+t+"_ne'></td>        </tr>      </table>      <table id='"+e+"_row2' class=\"mid table_window\">        <tr>          <td class='"+t+"_w'></td>            <td id='"+e+"_table_content' class='"+t+"_content' valign='top'>"+r+"</td>          <td class='"+t+"_e'></td>        </tr>      </table>        <table id='"+e+"_row3' class=\"bot table_window\">        <tr>          <td class='"+t+"_sw'></td>            <td class='"+t+"_s'><div id='"+e+"_bottom' class='status_bar'><span style='float:left; width:1px; height:1px'></span></div></td>            <td "+u+"></td>        </tr>      </table>    ";Element.hide(n);this.options.parent.insertBefore(n,this.options.parent.firstChild);Event.observe($(e+"_content"),"load",this.options.onload);return n},changeClassName:function(e){var t=this.options.className;var n=this.getId();$A(["_close","_minimize","_maximize","_sizer","_content"]).each(function(r){this._toggleClassName($(n+r),t+r,e+r)}.bind(this));this._toggleClassName($(n+"_top"),t+"_title",e+"_title");$$("#"+n+" td").each(function(n){n.className=n.className.sub(t,e)});this.options.className=e},_toggleClassName:function(e,t,n){if(e){e.removeClassName(t);e.addClassName(n)}},setLocation:function(e,t){e=this._updateTopConstraint(e);t=this._updateLeftConstraint(t);var n=this.currentDrag||this.element;n.setStyle({top:e+"px"});n.setStyle({left:t+"px"});this.useLeft=true;this.useTop=true},getLocation:function(){var e={};if(this.useTop)e=Object.extend(e,{top:this.element.getStyle("top")});else e=Object.extend(e,{bottom:this.element.getStyle("bottom")});if(this.useLeft)e=Object.extend(e,{left:this.element.getStyle("left")});else e=Object.extend(e,{right:this.element.getStyle("right")});return e},getSize:function(){return{width:this.width,height:this.height}},setSize:function(e,t,n){e=parseFloat(e);t=parseFloat(t);if(!this.minimized&&e<this.options.minWidth)e=this.options.minWidth;if(!this.minimized&&t<this.options.minHeight)t=this.options.minHeight;if(this.options.maxHeight&&t>this.options.maxHeight)t=this.options.maxHeight;if(this.options.maxWidth&&e>this.options.maxWidth)e=this.options.maxWidth;if(this.useTop&&this.useLeft&&Window.hasEffectLib&&Effect.ResizeWindow&&n){new Effect.ResizeWindow(this,null,null,e,t,{duration:Window.resizeEffectDuration})}else{this.width=e;this.height=t;var r=this.currentDrag?this.currentDrag:this.element;r.setStyle({width:e+this.widthW+this.widthE+"px"});r.setStyle({height:t+this.heightN+this.heightS+"px"});if(!this.currentDrag||this.currentDrag==this.element){var i=$(this.element.id+"_content");i.setStyle({height:t+"px"});i.setStyle({width:e+"px"})}}},updateHeight:function(){this.setSize(this.width,this.content.scrollHeight,true)},updateWidth:function(){this.setSize(this.content.scrollWidth,this.height,true)},toFront:function(){if(this.element.style.zIndex<Windows.maxZIndex)this.setZIndex(Windows.maxZIndex+1);if(this.iefix)this._fixIEOverlapping()},getBounds:function(e){if(!this.width||!this.height||!this.visible)this.computeBounds();var t=this.width;var n=this.height;if(!e){t+=this.widthW+this.widthE;n+=this.heightN+this.heightS}var r=Object.extend(this.getLocation(),{width:t+"px",height:n+"px"});return r},computeBounds:function(){if(!this.width||!this.height){var e=WindowUtilities._computeSize(this.content.innerHTML,this.content.id,this.width,this.height,0,this.options.className);if(this.height)this.width=e+5;else this.height=e+5}this.setSize(this.width,this.height);if(this.centered)this._center(this.centerTop,this.centerLeft)},show:function(e){this.visible=true;if(e){if(typeof this.overlayOpacity=="undefined"){var t=this;setTimeout(function(){t.show(e)},10);return}Windows.addModalWindow(this);this.modal=true;this.setZIndex(Windows.maxZIndex+1);Windows.unsetOverflow(this)}else if(!this.element.style.zIndex)this.setZIndex(Windows.maxZIndex+1);if(this.oldStyle)this.getContent().setStyle({overflow:this.oldStyle});this.computeBounds();this._notify("onBeforeShow");if(this.options.showEffect!=Element.show&&this.options.showEffectOptions)this.options.showEffect(this.element,this.options.showEffectOptions);else this.options.showEffect(this.element);this._checkIEOverlapping();WindowUtilities.focusedWindow=this;this._notify("onShow")},showCenter:function(e,t,n){this.centered=true;this.centerTop=t;this.centerLeft=n;this.show(e)},isVisible:function(){return this.visible},_center:function(e,t){var n=WindowUtilities.getWindowScroll(this.options.parent);var r=WindowUtilities.getPageSize(this.options.parent);if(typeof e=="undefined")e=(r.windowHeight-(this.height+this.heightN+this.heightS))/2;e+=n.top;if(typeof t=="undefined")t=(r.windowWidth-(this.width+this.widthW+this.widthE))/2;t+=n.left;this.setLocation(e,t);this.toFront()},_recenter:function(e){if(this.centered){var t=WindowUtilities.getPageSize(this.options.parent);var n=WindowUtilities.getWindowScroll(this.options.parent);if(this.pageSize&&this.pageSize.windowWidth==t.windowWidth&&this.pageSize.windowHeight==t.windowHeight&&this.windowScroll.left==n.left&&this.windowScroll.top==n.top)return;this.pageSize=t;this.windowScroll=n;if($("overlay_modal"))$("overlay_modal").setStyle({height:t.pageHeight+"px"});if(this.options.recenterAuto)this._center(this.centerTop,this.centerLeft)}},hide:function(){this.visible=false;if(this.modal){Windows.removeModalWindow(this);Windows.resetOverflow()}this.oldStyle=this.getContent().getStyle("overflow")||"auto";this.getContent().setStyle({overflow:"hidden"});this.options.hideEffect(this.element,this.options.hideEffectOptions);if(this.iefix)this.iefix.hide();if(!this.doNotNotifyHide)this._notify("onHide")},close:function(){if(this.visible){if(this.options.closeCallback&&!this.options.closeCallback(this))return;if(this.options.destroyOnClose){var e=this.destroy.bind(this);if(this.options.hideEffectOptions.afterFinish){var t=this.options.hideEffectOptions.afterFinish;this.options.hideEffectOptions.afterFinish=function(){t();e()}}else this.options.hideEffectOptions.afterFinish=function(){e()}}Windows.updateFocusedWindow();this.doNotNotifyHide=true;this.hide();this.doNotNotifyHide=false;this._notify("onClose")}},minimize:function(){if(this.resizing)return;var e=$(this.getId()+"_row2");if(!this.minimized){this.minimized=true;var t=e.getDimensions().height;this.r2Height=t;var n=this.element.getHeight()-t;if(this.useLeft&&this.useTop&&Window.hasEffectLib&&Effect.ResizeWindow){new Effect.ResizeWindow(this,null,null,null,this.height-t,{duration:Window.resizeEffectDuration})}else{this.height-=t;this.element.setStyle({height:n+"px"});e.hide()}if(!this.useTop){var r=parseFloat(this.element.getStyle("bottom"));this.element.setStyle({bottom:r+t+"px"})}}else{this.minimized=false;var t=this.r2Height;this.r2Height=null;if(this.useLeft&&this.useTop&&Window.hasEffectLib&&Effect.ResizeWindow){new Effect.ResizeWindow(this,null,null,null,this.height+t,{duration:Window.resizeEffectDuration})}else{var n=this.element.getHeight()+t;this.height+=t;this.element.setStyle({height:n+"px"});e.show()}if(!this.useTop){var r=parseFloat(this.element.getStyle("bottom"));this.element.setStyle({bottom:r-t+"px"})}this.toFront()}this._notify("onMinimize");this._saveCookie()},maximize:function(){if(this.isMinimized()||this.resizing)return;if(Prototype.Browser.IE&&this.heightN==0)this._getWindowBorderSize();if(this.storedLocation!=null){this._restoreLocation();if(this.iefix)this.iefix.hide()}else{this._storeLocation();Windows.unsetOverflow(this);var e=WindowUtilities.getWindowScroll(this.options.parent);var t=WindowUtilities.getPageSize(this.options.parent);var n=e.left;var r=e.top;if(this.options.parent!=document.body){e={top:0,left:0,bottom:0,right:0};var i=this.options.parent.getDimensions();t.windowWidth=i.width;t.windowHeight=i.height;r=0;n=0}if(this.constraint){t.windowWidth-=Math.max(0,this.constraintPad.left)+Math.max(0,this.constraintPad.right);t.windowHeight-=Math.max(0,this.constraintPad.top)+Math.max(0,this.constraintPad.bottom);n+=Math.max(0,this.constraintPad.left);r+=Math.max(0,this.constraintPad.top)}var s=t.windowWidth-this.widthW-this.widthE;var o=t.windowHeight-this.heightN-this.heightS;if(this.useLeft&&this.useTop&&Window.hasEffectLib&&Effect.ResizeWindow){new Effect.ResizeWindow(this,r,n,s,o,{duration:Window.resizeEffectDuration})}else{this.setSize(s,o);this.element.setStyle(this.useLeft?{left:n}:{right:n});this.element.setStyle(this.useTop?{top:r}:{bottom:r})}this.toFront();if(this.iefix)this._fixIEOverlapping()}this._notify("onMaximize");this._saveCookie()},isMinimized:function(){return this.minimized},isMaximized:function(){return this.storedLocation!=null},setOpacity:function(e){if(Element.setOpacity)Element.setOpacity(this.element,e)},setZIndex:function(e){this.element.setStyle({zIndex:e});Windows.updateZindex(e,this)},setTitle:function(e){if(!e||e=="")e="&nbsp;";Element.update(this.element.id+"_top",e)},getTitle:function(){return $(this.element.id+"_top").innerHTML},setStatusBar:function(e){var t=$(this.getId()+"_bottom");if(typeof e=="object"){if(this.bottombar.firstChild)this.bottombar.replaceChild(e,this.bottombar.firstChild);else this.bottombar.appendChild(e)}else this.bottombar.innerHTML=e},_checkIEOverlapping:function(){if(!this.iefix&&navigator.appVersion.indexOf("MSIE")>0&&navigator.userAgent.indexOf("Opera")<0&&this.element.getStyle("position")=="absolute"){new Insertion.After(this.element.id,'<iframe id="'+this.element.id+'_iefix" '+'style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.element.id+"_iefix")}if(this.iefix)setTimeout(this._fixIEOverlapping.bind(this),50)},_fixIEOverlapping:function(){Position.clone(this.element,this.iefix);this.iefix.style.zIndex=this.element.style.zIndex-1;this.iefix.show()},_getWindowBorderSize:function(e){var t=this._createHiddenDiv(this.options.className+"_n");this.heightN=Element.getDimensions(t).height;t.parentNode.removeChild(t);var t=this._createHiddenDiv(this.options.className+"_s");this.heightS=Element.getDimensions(t).height;t.parentNode.removeChild(t);var t=this._createHiddenDiv(this.options.className+"_e");this.widthE=Element.getDimensions(t).width;t.parentNode.removeChild(t);var t=this._createHiddenDiv(this.options.className+"_w");this.widthW=Element.getDimensions(t).width;t.parentNode.removeChild(t);var t=document.createElement("div");t.className="overlay_"+this.options.className;document.body.appendChild(t);var n=this;setTimeout(function(){n.overlayOpacity=$(t).getStyle("opacity");t.parentNode.removeChild(t)},10);if(Prototype.Browser.IE){this.heightS=$(this.getId()+"_row3").getDimensions().height;this.heightN=$(this.getId()+"_row1").getDimensions().height}if(Prototype.Browser.WebKit&&Prototype.Browser.WebKitVersion<420)this.setSize(this.width,this.height);if(this.doMaximize)this.maximize();if(this.doMinimize)this.minimize()},_createHiddenDiv:function(e){var t=document.body;var n=document.createElement("div");n.setAttribute("id",this.element.id+"_tmp");n.className=e;n.style.display="none";n.innerHTML="";t.insertBefore(n,t.firstChild);return n},_storeLocation:function(){if(this.storedLocation==null){this.storedLocation={useTop:this.useTop,useLeft:this.useLeft,top:this.element.getStyle("top"),bottom:this.element.getStyle("bottom"),left:this.element.getStyle("left"),right:this.element.getStyle("right"),width:this.width,height:this.height}}},_restoreLocation:function(){if(this.storedLocation!=null){this.useLeft=this.storedLocation.useLeft;this.useTop=this.storedLocation.useTop;if(this.useLeft&&this.useTop&&Window.hasEffectLib&&Effect.ResizeWindow)new Effect.ResizeWindow(this,this.storedLocation.top,this.storedLocation.left,this.storedLocation.width,this.storedLocation.height,{duration:Window.resizeEffectDuration});else{this.element.setStyle(this.useLeft?{left:this.storedLocation.left}:{right:this.storedLocation.right});this.element.setStyle(this.useTop?{top:this.storedLocation.top}:{bottom:this.storedLocation.bottom});this.setSize(this.storedLocation.width,this.storedLocation.height)}Windows.resetOverflow();this._removeStoreLocation()}},_removeStoreLocation:function(){this.storedLocation=null},_saveCookie:function(){if(this.cookie){var e="";if(this.useLeft)e+="l:"+(this.storedLocation?this.storedLocation.left:this.element.getStyle("left"));else e+="r:"+(this.storedLocation?this.storedLocation.right:this.element.getStyle("right"));if(this.useTop)e+=",t:"+(this.storedLocation?this.storedLocation.top:this.element.getStyle("top"));else e+=",b:"+(this.storedLocation?this.storedLocation.bottom:this.element.getStyle("bottom"));e+=","+(this.storedLocation?this.storedLocation.width:this.width);e+=","+(this.storedLocation?this.storedLocation.height:this.height);e+=","+this.isMinimized();e+=","+this.isMaximized();WindowUtilities.setCookie(e,this.cookie)}},_createWiredElement:function(){if(!this.wiredElement){if(Prototype.Browser.IE)this._getWindowBorderSize();var e=document.createElement("div");e.className="wired_frame "+this.options.className+"_wired_frame";e.style.position="absolute";this.options.parent.insertBefore(e,this.options.parent.firstChild);this.wiredElement=$(e)}if(this.useLeft)this.wiredElement.setStyle({left:this.element.getStyle("left")});else this.wiredElement.setStyle({right:this.element.getStyle("right")});if(this.useTop)this.wiredElement.setStyle({top:this.element.getStyle("top")});else this.wiredElement.setStyle({bottom:this.element.getStyle("bottom")});var t=this.element.getDimensions();this.wiredElement.setStyle({width:t.width+"px",height:t.height+"px"});this.wiredElement.setStyle({zIndex:Windows.maxZIndex+30});return this.wiredElement},_hideWiredElement:function(){if(!this.wiredElement||!this.currentDrag)return;if(this.currentDrag==this.element)this.currentDrag=null;else{if(this.useLeft)this.element.setStyle({left:this.currentDrag.getStyle("left")});else this.element.setStyle({right:this.currentDrag.getStyle("right")});if(this.useTop)this.element.setStyle({top:this.currentDrag.getStyle("top")});else this.element.setStyle({bottom:this.currentDrag.getStyle("bottom")});this.currentDrag.hide();this.currentDrag=null;if(this.doResize)this.setSize(this.width,this.height)}},_notify:function(e){if(this.options[e])this.options[e](this);else Windows.notify(e,this)}};var Windows={windows:[],modalWindows:[],observers:[],focusedWindow:null,maxZIndex:0,overlayShowEffectOptions:{duration:.5},overlayHideEffectOptions:{duration:.5},addObserver:function(e){this.removeObserver(e);this.observers.push(e)},removeObserver:function(e){this.observers=this.observers.reject(function(t){return t==e})},notify:function(e,t){this.observers.each(function(n){if(n[e])n[e](e,t)})},getWindow:function(e){return this.windows.detect(function(t){return t.getId()==e})},getFocusedWindow:function(){return this.focusedWindow},updateFocusedWindow:function(){this.focusedWindow=this.windows.length>=2?this.windows[this.windows.length-2]:null},register:function(e){this.windows.push(e)},addModalWindow:function(e){if(this.modalWindows.length==0){WindowUtilities.disableScreen(e.options.className,"overlay_modal",e.overlayOpacity,e.getId(),e.options.parent)}else{if(Window.keepMultiModalWindow){$("overlay_modal").style.zIndex=Windows.maxZIndex+1;Windows.maxZIndex+=1;WindowUtilities._hideSelect(this.modalWindows.last().getId())}else this.modalWindows.last().element.hide();WindowUtilities._showSelect(e.getId())}this.modalWindows.push(e)},removeModalWindow:function(e){this.modalWindows.pop();if(this.modalWindows.length==0)WindowUtilities.enableScreen();else{if(Window.keepMultiModalWindow){this.modalWindows.last().toFront();WindowUtilities._showSelect(this.modalWindows.last().getId())}else this.modalWindows.last().element.show()}},register:function(e){this.windows.push(e)},unregister:function(e){this.windows=this.windows.reject(function(t){return t==e})},closeAll:function(){this.windows.each(function(e){Windows.close(e.getId())})},closeAllModalWindows:function(){WindowUtilities.enableScreen();this.modalWindows.each(function(e){if(e)e.close()})},minimize:function(e,t){var n=this.getWindow(e);if(n&&n.visible)n.minimize();Event.stop(t)},maximize:function(e,t){var n=this.getWindow(e);if(n&&n.visible)n.maximize();Event.stop(t)},close:function(e,t){var n=this.getWindow(e);if(n)n.close();if(t)Event.stop(t)},blur:function(e){var t=this.getWindow(e);if(!t)return;if(t.options.blurClassName)t.changeClassName(t.options.blurClassName);if(this.focusedWindow==t)this.focusedWindow=null;t._notify("onBlur")},focus:function(e){var t=this.getWindow(e);if(!t)return;if(this.focusedWindow)this.blur(this.focusedWindow.getId());if(t.options.focusClassName)t.changeClassName(t.options.focusClassName);this.focusedWindow=t;t._notify("onFocus")},unsetOverflow:function(e){this.windows.each(function(e){e.oldOverflow=e.getContent().getStyle("overflow")||"auto";e.getContent().setStyle({overflow:"hidden"})});if(e&&e.oldOverflow)e.getContent().setStyle({overflow:e.oldOverflow})},resetOverflow:function(){this.windows.each(function(e){if(e.oldOverflow)e.getContent().setStyle({overflow:e.oldOverflow})})},updateZindex:function(e,t){if(e>this.maxZIndex){this.maxZIndex=e;if(this.focusedWindow)this.blur(this.focusedWindow.getId())}this.focusedWindow=t;if(this.focusedWindow)this.focus(this.focusedWindow.getId())}};var Dialog={dialogId:null,onCompleteFunc:null,callFunc:null,parameters:null,confirm:function(e,t){if(e&&typeof e!="string"){Dialog._runAjaxRequest(e,t,Dialog.confirm);return}e=e||"";t=t||{};var n=t.okLabel?t.okLabel:"Ok";var r=t.cancelLabel?t.cancelLabel:"Cancel";t=Object.extend(t,t.windowParameters||{});t.windowParameters=t.windowParameters||{};t.className=t.className||"alert";var i="class ='"+(t.buttonClass?t.buttonClass+" ":"")+" ok_button'";var s="class ='"+(t.buttonClass?t.buttonClass+" ":"")+" cancel_button'";var e="      <div class='"+t.className+"_message'>"+e+"</div>        <div class='"+t.className+"_buttons'>          <input type='button' value='"+n+"' onclick='Dialog.okCallback()' "+i+"/>          <input type='button' value='"+r+"' onclick='Dialog.cancelCallback()' "+s+"/>        </div>    ";return this._openDialog(e,t)},alert:function(e,t){if(e&&typeof e!="string"){Dialog._runAjaxRequest(e,t,Dialog.alert);return}e=e||"";t=t||{};var n=t.okLabel?t.okLabel:"Ok";t=Object.extend(t,t.windowParameters||{});t.windowParameters=t.windowParameters||{};t.className=t.className||"alert";var r="class ='"+(t.buttonClass?t.buttonClass+" ":"")+" ok_button'";var e="      <div class='"+t.className+"_message'>"+e+"</div>        <div class='"+t.className+"_buttons'>          <input type='button' value='"+n+"' onclick='Dialog.okCallback()' "+r+"/>        </div>";return this._openDialog(e,t)},info:function(e,t){if(e&&typeof e!="string"){Dialog._runAjaxRequest(e,t,Dialog.info);return}e=e||"";t=t||{};t=Object.extend(t,t.windowParameters||{});t.windowParameters=t.windowParameters||{};t.className=t.className||"alert";var e="<div id='modal_dialog_message' class='"+t.className+"_message'>"+e+"</div>";if(t.showProgress)e+="<div id='modal_dialog_progress' class='"+t.className+"_progress'>  </div>";t.ok=null;t.cancel=null;return this._openDialog(e,t)},setInfoMessage:function(e){$("modal_dialog_message").update(e)},closeInfo:function(){Windows.close(this.dialogId)},_openDialog:function(e,t){var n=t.className;if(!t.height&&!t.width){t.width=WindowUtilities.getPageSize(t.options.parent||document.body).pageWidth/2}if(t.id)this.dialogId=t.id;else{var r=new Date;this.dialogId="modal_dialog_"+r.getTime();t.id=this.dialogId}if(!t.height||!t.width){var i=WindowUtilities._computeSize(e,this.dialogId,t.width,t.height,5,n);if(t.height)t.width=i+5;else t.height=i+5}t.effectOptions=t.effectOptions;t.resizable=t.resizable||false;t.minimizable=t.minimizable||false;t.maximizable=t.maximizable||false;t.draggable=t.draggable||false;t.closable=t.closable||false;var s=new Window(t);s.getContent().innerHTML=e;s.showCenter(true,t.top,t.left);s.setDestroyOnClose();s.cancelCallback=t.onCancel||t.cancel;s.okCallback=t.onOk||t.ok;return s},_getAjaxContent:function(e){Dialog.callFunc(e.responseText,Dialog.parameters)},_runAjaxRequest:function(e,t,n){if(e.options==null)e.options={};Dialog.onCompleteFunc=e.options.onComplete;Dialog.parameters=t;Dialog.callFunc=n;e.options.onComplete=Dialog._getAjaxContent;new Ajax.Request(e.url,e.options)},okCallback:function(){var e=Windows.focusedWindow;if(!e.okCallback||e.okCallback(e)){$$("#"+e.getId()+" input").each(function(e){e.onclick=null});e.close()}},cancelCallback:function(){var e=Windows.focusedWindow;$$("#"+e.getId()+" input").each(function(e){e.onclick=null});e.close();if(e.cancelCallback)e.cancelCallback(e)}};if(Prototype.Browser.WebKit){var array=navigator.userAgent.match(new RegExp(/AppleWebKit\/([\d\.\+]*)/));Prototype.Browser.WebKitVersion=parseFloat(array[1])}var WindowUtilities={getWindowScroll:function(parent){var T,L,W,H;parent=parent||document.body;if(parent!=document.body){T=parent.scrollTop;L=parent.scrollLeft;W=parent.scrollWidth;H=parent.scrollHeight}else{var w=window;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft}else if(w.document.body){T=body.scrollTop;L=body.scrollLeft}if(w.innerWidth){W=w.innerWidth;H=w.innerHeight}else if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight}else{W=body.offsetWidth;H=body.offsetHeight}}}return{top:T,left:L,width:W,height:H}},getPageSize:function(e){e=e||document.body;var t,n;var r,i;if(e!=document.body){t=e.getWidth();n=e.getHeight();i=e.scrollWidth;r=e.scrollHeight}else{var s,o;if(window.innerHeight&&window.scrollMaxY){s=document.body.scrollWidth;o=window.innerHeight+window.scrollMaxY}else if(document.body.scrollHeight>document.body.offsetHeight){s=document.body.scrollWidth;o=document.body.scrollHeight}else{s=document.body.offsetWidth;o=document.body.offsetHeight}if(self.innerHeight){t=self.innerWidth;n=self.innerHeight}else if(document.documentElement&&document.documentElement.clientHeight){t=document.documentElement.clientWidth;n=document.documentElement.clientHeight}else if(document.body){t=document.body.clientWidth;n=document.body.clientHeight}if(o<n){r=n}else{r=o}if(s<t){i=t}else{i=s}}return{pageWidth:i,pageHeight:r,windowWidth:t,windowHeight:n}},disableScreen:function(e,t,n,r,i){WindowUtilities.initLightbox(t,e,function(){this._disableScreen(e,t,n,r)}.bind(this),i||document.body)},_disableScreen:function(e,t,n,r){var i=$(t);var s=WindowUtilities.getPageSize(i.parentNode);if(r&&Prototype.Browser.IE){WindowUtilities._hideSelect();WindowUtilities._showSelect(r)}i.style.height=s.pageHeight+"px";i.style.display="none";if(t=="overlay_modal"&&Window.hasEffectLib&&Windows.overlayShowEffectOptions){i.overlayOpacity=n;new Effect.Appear(i,Object.extend({from:0,to:n},Windows.overlayShowEffectOptions))}else i.style.display="block"},enableScreen:function(e){e=e||"overlay_modal";var t=$(e);if(t){if(e=="overlay_modal"&&Window.hasEffectLib&&Windows.overlayHideEffectOptions)new Effect.Fade(t,Object.extend({from:t.overlayOpacity,to:0},Windows.overlayHideEffectOptions));else{t.style.display="none";t.parentNode.removeChild(t)}if(e!="__invisible__")WindowUtilities._showSelect()}},_hideSelect:function(e){if(Prototype.Browser.IE){e=e==null?"":"#"+e+" ";$$(e+"select").each(function(e){if(!WindowUtilities.isDefined(e.oldVisibility)){e.oldVisibility=e.style.visibility?e.style.visibility:"visible";e.style.visibility="hidden"}})}},_showSelect:function(e){if(Prototype.Browser.IE){e=e==null?"":"#"+e+" ";$$(e+"select").each(function(e){if(WindowUtilities.isDefined(e.oldVisibility)){try{e.style.visibility=e.oldVisibility}catch(t){e.style.visibility="visible"}e.oldVisibility=null}else{if(e.style.visibility)e.style.visibility="visible"}})}},isDefined:function(e){return typeof e!="undefined"&&e!=null},initLightbox:function(e,t,n,r){if($(e)){Element.setStyle(e,{zIndex:Windows.maxZIndex+1});Windows.maxZIndex++;n()}else{var i=document.createElement("div");i.setAttribute("id",e);i.className="overlay_"+t;i.style.display="none";i.style.position="absolute";i.style.top="0";i.style.left="0";i.style.zIndex=Windows.maxZIndex+1;Windows.maxZIndex++;i.style.width="100%";r.insertBefore(i,r.firstChild);if(Prototype.Browser.WebKit&&e=="overlay_modal"){setTimeout(function(){n()},10)}else n()}},setCookie:function(e,t){document.cookie=t[0]+"="+escape(e)+(t[1]?"; expires="+t[1].toGMTString():"")+(t[2]?"; path="+t[2]:"")+(t[3]?"; domain="+t[3]:"")+(t[4]?"; secure":"")},getCookie:function(e){var t=document.cookie;var n=e+"=";var r=t.indexOf("; "+n);if(r==-1){r=t.indexOf(n);if(r!=0)return null}else{r+=2}var i=document.cookie.indexOf(";",r);if(i==-1){i=t.length}return unescape(t.substring(r+n.length,i))},_computeSize:function(e,t,n,r,i,s){var o=document.body;var u=document.createElement("div");u.setAttribute("id",t);u.className=s+"_content";if(r)u.style.height=r+"px";else u.style.width=n+"px";u.style.position="absolute";u.style.top="0";u.style.left="0";u.style.display="none";u.innerHTML=e;o.insertBefore(u,o.firstChild);var a;if(r)a=$(u).getDimensions().width+i;else a=$(u).getDimensions().height+i;o.removeChild(u);return a}}