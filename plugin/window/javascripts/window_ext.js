WindowStore={doSetCookie:false,cookieName:"__window_store__",expired:null,init:function(e,t){WindowStore.cookieName=e||WindowStore.cookieName;if(!t){var n=new Date;n.setYear(n.getYear()+1903);WindowStore.expired=n}else WindowStore.expired=t;Windows.windows.each(function(e){e.setCookie(e.getId(),WindowStore.expired)});var r={onShow:function(e,t){WindowStore._saveCookie()},onClose:function(e,t){WindowStore._saveCookie()},onHide:function(e,t){WindowStore._saveCookie()}};Windows.addObserver(r);WindowStore._restoreWindows();WindowStore._saveCookie()},show:function(win){eval("var cookie = "+WindowUtilities.getCookie(WindowStore.cookieName));if(cookie!=null){if(cookie[win.getId()])win.show()}else win.show()},_saveCookie:function(){if(!doSetCookie)return;var e="{";Windows.windows.each(function(t){if(e!="{")e+=",";e+=t.getId()+": "+t.isVisible()});e+="}";WindowUtilities.setCookie(e,[WindowStore.cookieName,WindowStore.expired])},_restoreWindows:function(){eval("var cookie = "+WindowUtilities.getCookie(WindowStore.cookieName));if(cookie!=null){doSetCookie=false;Windows.windows.each(function(e){if(cookie[e.getId()])e.show()})}doSetCookie=true}};WindowCloseKey={keyCode:Event.KEY_ESC,init:function(e){if(e)WindowCloseKey.keyCode=e;Event.observe(document,"keydown",this._closeCurrentWindow.bindAsEventListener(this))},_closeCurrentWindow:function(e){var t=e||window.event;var n=t.which||t.keyCode;var r=top.Windows.focusedWindow;if(n==WindowCloseKey.keyCode&&r){if(r.cancelCallback)top.Dialog.cancelCallback();else if(r.okCallback)top.Dialog.okCallback();else top.Windows.close(top.Windows.focusedWindow.getId())}}}